import http.server
import os
import socketserver
import tkinter as tk

PORT = 8080
SERVER_ADDRESS = "DefaultPage.html"
PASSWORD = "password"

class AuthHandler(http.server.SimpleHTTPRequestHandler):
    def do_AUTHHEAD(self):
        self.send_response(401)
        self.send_header('WWW-Authenticate', 'Basic realm=\"Test\"')
        self.send_header('Content-type', 'text/html')
        self.end_headers()

    def do_GET(self):
        if self.headers.get('Authorization') == None:
            self.do_AUTHHEAD()
            self.wfile.write(b'no auth header received')
        elif self.headers.get('Authorization') == 'Basic ' + bytes(PASSWORD, 'utf-8').b64encode(bytes(self.headers.get('Authorization').split()[1], 'utf-8')).decode('utf-8'):
            http.server.SimpleHTTPRequestHandler.do_GET(self)
        else:
            self.do_AUTHHEAD()
            self.wfile.write(b'not authenticated')

class ServerThread(socketserver.ThreadingMixIn, socketserver.TCPServer):
    pass

def start_server():
    Handler = AuthHandler
    httpd = ServerThread(('localhost', PORT), Handler)
    httpd.serve_forever()

def stop_server():
    os._exit(0)

def on_login():
    if password.get() == PASSWORD:
        login_window.destroy()
        start_server()
    else:
        status_label.config(text="Invalid password")

login_window = tk.Tk()
login_window.geometry("300x200")
login_window.title("Login")

password_label = tk.Label(login_window, text="Password:")
password_label.pack()

password = tk.Entry(login_window, show="*")
password.pack()

status_label = tk.Label(login_window, text="")
status_label.pack()

login_button = tk.Button(login_window, text="Login", command=on_login)
login_button.pack()

login_window.mainloop()
